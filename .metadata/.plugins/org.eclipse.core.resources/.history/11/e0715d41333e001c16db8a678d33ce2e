/******************************************************************************
 *
 * File Name: main1.c
 *
 * Description: 
 *
 * Author: John Emile
 *
 * Date : Nov 2, 2021
 *
 *******************************************************************************/

#include "application_micro1.h"
#include "lcd.h"
#include <avr/io.h>
#include "timer.h"

#define NUMBER_OF_COMPARE_MATCHES_PER_SECONDS  			4
#define F_CPU 8000000UL

/************************************************************************
 *                           Global variables                           *
 ************************************************************************/
/* holds the UDR of UART whenever there's data in it */
volatile uint8 g_recievedValue=0;

/*Flag that is set to one whenever there's data in UDR */
volatile uint8 g_recievedFlag=0 ;
//
//volatile uint8 g_tick =0;
//
//
//void TIMER02_delay(void)
//{
//	g_tick++;
//	/* Wait until g_tick = no of seconds delayed */
//	while (g_tick != NUMBER_OF_COMPARE_MATCHES_PER_SECONDS);
//}

int main(void)
{
	/* Modules initialization */
	LCD_init();

	UART_ConfigType UART_configPtr = {UART_BIT_RATE_9600_BITS_PER_SECONDS,UART_EIGHT_BIT_DATA_MODE,UART_PARITY_DISABLED,UART_ONE_STOP_BIT};
	UART_init(&UART_configPtr);

//	/* Enable Global Interrupt */
//	SREG |= (1<<7);

	/* Wait until MC2 is ready to receive the string */
	while(UART_recieveByte() != MICRO2_READY){}

	/* Send the required string to MC2 through UART */
	UART_sendString("I am Micro1#");


	for (;;)
	{
//		switch(g_recievedValue)
//		{
//		case ASK_FOR_PASSWORD :
//
//			g_recievedValue=0;
//
//			APP_askForPassword();
//			break;
//
//		case ASK_FOR_MENU :
//
//			g_recievedValue=0;
//
//			APP_mainMenu();
//			break;
//
//		case PASSWORDS_UNMATCHED :
//
//			/* Reset received value in order not to execute again */
//			g_recievedValue=0;
//
//			/* LCD Commands */
//			LCD_clearScreen();
//			LCD_displayString("Unmatched");
//
//			/* Delay for 1 sec using timer */
//			TIMER_ConfigType config1 = {TIMER0_ID,TIMER02_MODE_COMPARE,0,250,TIMER_CLOCK_CPU_1024};
//			TIMER_init(&config1);
//			TIMER0_setCallback(&TIMER02_delay);
//
//			/* Ask for password entry again */
//			APP_askForPassword();
//
//			break;
//
//		case PASSWORDS_MATCHED :
//
//			/* Reset received value in order not to execute again */
//			g_recievedValue=0;
//			g_recievedFlag=0;
//
//			/* LCD Commands */
//			LCD_clearScreen();
//			LCD_displayString("Matched");
//
//			/* Show menu */
//			/* Delay for 1 sec using timer */
//			APP_mainMenu();
//			break;
//
//		case PASSWORD_WRONG :
//
//			/* Reset received value in order not to execute again */
//			g_recievedValue=0;
//			g_recievedFlag=0;
//
//			/* LCD Commands */
//			LCD_clearScreen();
//			LCD_displayString("WRONG PASSWORD");
//
//			/* Show menu */
//			/* Delay for 1 sec using timer */
//			APP_mainMenu();
//
//			break;
//
//		case DOOR_OPENING :
//
//			/* Reset received value in order not to execute again */
//			g_recievedValue=0;
//			g_recievedFlag=0;
//
//			/* LCD Commands */
//			LCD_clearScreen();
//			LCD_displayString("Door is Opening");
//			break;
//
//		case DOOR_CLOSING :
//
//			/* Reset received value in order not to execute again */
//			g_recievedValue=0;
//			g_recievedFlag=0;
//
//			/* LCD Commands */
//			LCD_clearScreen();
//			LCD_displayString("Door is Closing");
//			break;
//		}

	}
}
